#
# Description:
# The PAM 'bios' service configuration file for the Eaton $BIOS project.
# Note that this file must be named 'bios' to identify the service name.
# This allows members of the groups listed in /etc/security/bios_groups.conf
# (i.e. the 'bios' group by default) to PAM/SASL-authenticate to the daemons.
# See also the script to generate these needed $BIOS accounts and groups:
#    tools/init-os-accounts.sh
#
# Most of the PAM setup code below is relatively standard boilerplate,
# it is here just to ensure these lines are defined regardless of
# the distribution used. Probably some of the explicit lines repeat
# definitions in "common-*" includables, but PAM does not complain
# and so we don't ;) If your older PAM does not support "include",
# just comment those lines away.
# The one actually unique snippet begins at "pam_listfile.so".
#
# Some required legalese follows:
#
# Copyright (C) 2014 Eaton
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
# Author(s): Jim Klimov <EvgenyKlimov@eaton.com>

    auth	required        pam_env.so
    auth	required        pam_unix.so	try_first_pass

# Note that "requisite" mismatch fails instantly,
# while "required" goes on to other checks first
    auth	requisite	pam_listfile.so	onerr=fail item=group sense=allow file=/etc/security/bios_groups.conf

@include	common-auth

    account	required	pam_unix.so	try_first_pass

@include	common-account

    password	requisite	pam_cracklib.so
    password	required	pam_unix.so	use_authtok shadow try_first_pass

@include	common-password

    session	required	pam_limits.so
    session	required	pam_unix.so	try_first_pass
    session	optional	pam_umask.so
    session	optional	pam_env.so

 @include	common-session-noninteractive

